function method(e,o){return function(){e[o].apply(e,arguments)}}var StopIteration={toString:function(){return"StopIteration"}};function forEach(e,o){if(e.next)try{for(;;)o(e.next())}catch(k){if(k!=StopIteration)throw k;}else for(var p=0;p<e.length;p++)o(e[p])}function map(e,o){var k=[];forEach(e,function(p){k.push(o(p))});return k}function matcher(e){return function(o){return e.test(o)}}function hasClass(e,o){var k=e.className;return k&&RegExp("(^| )"+o+"($| )").test(k)}
function insertAfter(e,o){o.parentNode.insertBefore(e,o.nextSibling);return e}function removeElement(e){e.parentNode&&e.parentNode.removeChild(e)}function clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function isAncestor(e,o){for(;o=o.parentNode;)if(e==o)return true;return false}var nbsp="\u00a0",matching={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("};
function normalizeEvent(e){if(!e.stopPropagation){e.stopPropagation=function(){this.cancelBubble=true};e.preventDefault=function(){this.returnValue=false}}if(!e.stop)e.stop=function(){this.stopPropagation();this.preventDefault()};if(e.type=="keypress"){e.code=e.charCode==null?e.keyCode:e.charCode;e.character=String.fromCharCode(e.code)}return e}
function addEventHandler(e,o,k,p){function n(t){k(normalizeEvent(t||window.event))}if(typeof e.addEventListener=="function"){e.addEventListener(o,n,false);if(p)return function(){e.removeEventListener(o,n,false)}}else{e.attachEvent("on"+o,n);if(p)return function(){e.detachEvent("on"+o,n)}}}function nodeText(e){return e.textContent||e.innerText||e.nodeValue||""}function nodeTop(e){for(var o=0;e.offsetParent;){o+=e.offsetTop;e=e.offsetParent}return o}
function isBR(e){e=e.nodeName;return e=="BR"||e=="br"}function isSpan(e){e=e.nodeName;return e=="SPAN"||e=="span"};var stringStream=function(e){function o(){for(;p==k.length;){n+=k;k="";p=0;try{k=e.next()}catch(t){if(t!=StopIteration)throw t;else return false}}return true}var k="",p=0,n="";return{peek:function(){if(!o())return null;return k.charAt(p)},next:function(){if(!o())if(n.length>0)throw"End of stringstream reached without emptying buffer ('"+n+"').";else throw StopIteration;return k.charAt(p++)},get:function(){var t=n;n="";if(p>0){t+=k.slice(0,p);k=k.slice(p);p=0}return t},push:function(t){k=k.slice(0,
p)+t+k.slice(p)},lookAhead:function(t,v,i,b){function a(j){return b?j.toLowerCase():j}t=a(t);var c=false,d=n,g=p;for(i&&this.nextWhileMatches(/[\s\u00a0]/);;){i=p+t.length;var h=k.length-p;if(i<=k.length){c=t==a(k.slice(p,i));p=i;break}else if(t.slice(0,h)==a(k.slice(p))){n+=k;k="";try{k=e.next()}catch(f){break}p=0;t=t.slice(h)}else break}if(!(c&&v)){k=n.slice(d.length)+k;p=g;n=d}return c},more:function(){return this.peek()!==null},applies:function(t){var v=this.peek();return v!==null&&t(v)},nextWhile:function(t){for(var v;(v=
this.peek())!==null&&t(v);)this.next()},matches:function(t){var v=this.peek();return v!==null&&t.test(v)},nextWhileMatches:function(t){for(var v;(v=this.peek())!==null&&t.test(v);)this.next()},equals:function(t){return t===this.peek()},endOfLine:function(){var t=this.peek();return t==null||t=="\n"}}};var select={};
(function(){function e(a,c){for(;a&&a.parentNode!=c;)a=a.parentNode;return a}function o(a,c){for(;!a.previousSibling&&a.parentNode!=c;)a=a.parentNode;return e(a.previousSibling,c)}select.ie_selection=document.selection&&document.selection.createRangeCollection;select.scrollToNode=function(a,c){if(a){var d=a,g=d.ownerDocument,h=g.body,f=g.defaultView||g.parentWindow;g=g.documentElement;for(var j=!d.nextSibling||!d.nextSibling.nextSibling||!d.nextSibling.nextSibling.nextSibling,l=0;d&&!d.offsetTop;){l++;
d=d.previousSibling}if(l==0)j=false;if(!(webkit&&d&&d.offsetTop==5&&d.offsetLeft==5)){l=l*(d?d.offsetHeight:0);var r=0,u=a?a.offsetWidth:0;for(d=d;d&&d.offsetParent;){l+=d.offsetTop;isBR(d)||(r+=d.offsetLeft);d=d.offsetParent}d=h.scrollLeft||g.scrollLeft||0;h=h.scrollTop||g.scrollTop||0;var q=false,s=f.innerWidth||g.clientWidth||0;if(c||u<s){if(c){var z=select.offsetInNode(f,a),A=nodeText(a).length;if(A)r+=u*(z/A)}u=r-d;if(u<0||u>s){d=r;q=true}}r=l-h;if(r<0||j||r>(f.innerHeight||g.clientHeight||0)-
50){h=j?1E6:l;q=true}q&&f.scrollTo(d,h)}}};select.scrollToCursor=function(a){select.scrollToNode(select.selectionTopNode(a,true)||a.firstChild,true)};var k=null;select.snapshotChanged=function(){if(k)k.changed=true};select.snapshotReplaceNode=function(a,c,d,g){function h(f){if(a==f.node){k.changed=true;if(d&&f.offset>d)f.offset-=d;else{f.node=c;f.offset+=g||0}}}if(k){h(k.start);h(k.end)}};select.snapshotMove=function(a,c,d,g,h){function f(j){if(a==j.node&&(!h||j.offset==0)){k.changed=true;j.node=
c;j.offset=g?Math.max(0,j.offset+d):d}}if(k){f(k.start);f(k.end)}};if(select.ie_selection){var p=function(a,c){function d(q){for(var s=null;!s&&q;){s=q.nextSibling;q=q.parentNode}return g(s)}function g(q){for(;q&&q.firstChild;)q=q.firstChild;return{node:q,offset:0}}var h=a.document.selection.createRange();h.collapse(c);var f=h.parentElement();if(!isAncestor(a.document.body,f))return null;if(!f.firstChild)return g(f);var j=h.duplicate();j.moveToElementText(f);j.collapse(true);for(var l=f.firstChild;l;l=
l.nextSibling){if(l.nodeType==3){var r=l.nodeValue.length;j.move("character",r)}else{j.moveToElementText(l);j.collapse(false)}var u=h.compareEndPoints("StartToStart",j);if(u==0)return d(l);if(u!=1){if(l.nodeType!=3)return g(l);j.setEndPoint("StartToEnd",h);return{node:l,offset:r-j.text.length}}}return d(f)};select.markSelection=function(a){k=null;if(a.document.selection){var c=p(a,true),d=p(a,false);if(c&&d)k={start:c,end:d,window:a,changed:false}}};select.selectMarked=function(){function a(h){var f=
c.body.createTextRange(),j=h.node;if(j)if(j.nodeType==3){f.moveToElementText(j.parentNode);for(h=h.offset;j.previousSibling;){j=j.previousSibling;h+=(j.innerText||"").length}f.move("character",h)}else{f.moveToElementText(j);f.collapse(true)}else{f.moveToElementText(k.window.document.body);f.collapse(false)}return f}if(k&&k.changed){var c=k.window.document,d=a(k.start),g=a(k.end);d.setEndPoint("StartToEnd",g);d.select()}};select.offsetInNode=function(a,c){var d=a.document.selection;if(!d)return 0;
d=d.createRange();var g=d.duplicate();try{g.moveToElementText(c)}catch(h){return 0}d.setEndPoint("StartToStart",g);return d.text.length};select.selectionTopNode=function(a,c){function d(r,u){if(u.nodeType==3){for(var q=0,s=u.previousSibling;s&&s.nodeType==3;){q+=s.nodeValue.length;s=s.previousSibling}if(s){try{r.moveToElementText(s)}catch(z){return false}r.collapse(false)}else r.moveToElementText(u.parentNode);q&&r.move("character",q)}else try{r.moveToElementText(u)}catch(A){return false}return true}
var g=a.ownerDocument.selection;if(!g)return false;g=g.createRange();var h=g.duplicate();g.collapse(c);var f=g.parentElement();if(f&&isAncestor(a,f)){h.moveToElementText(f);if(g.compareEndPoints("StartToStart",h)==1)return e(f,a)}c=0;for(f=a.childNodes.length-1;c<f;){var j=Math.ceil((f+c)/2),l=a.childNodes[j];if(!l)return false;if(!d(h,l))return false;if(g.compareEndPoints("StartToStart",h)==1)c=j;else f=j-1}return a.childNodes[c]||null};select.focusAfterNode=function(a,c){var d=c.ownerDocument.body.createTextRange();
d.moveToElementText(a||c);d.collapse(!a);d.select()};select.somethingSelected=function(a){return(a=a.document.selection)&&a.createRange().text!=""};var n=function(a,c){var d=a.document.selection;if(d){d=d.createRange();d.pasteHTML(c);d.collapse(false);d.select()}};select.insertNewlineAtCursor=function(a){n(a,"<br>")};select.insertTabAtCursor=function(a){n(a,"\u00a0\u00a0\u00a0\u00a0")};select.cursorPos=function(a,c){var d=a.ownerDocument.selection;if(!d)return null;for(var g=select.selectionTopNode(a,
c);g&&!isBR(g);)g=g.previousSibling;d=d.createRange();var h=d.duplicate();d.collapse(c);if(g){h.moveToElementText(g);h.collapse(false)}else{try{h.moveToElementText(a)}catch(f){return null}h.collapse(true)}d.setEndPoint("StartToStart",h);return{node:g,offset:d.text.length}};select.setCursorPos=function(a,c,d){function g(f){var j=a.ownerDocument.body.createTextRange();if(f.node){j.moveToElementText(f.node);j.collapse(false)}else{j.moveToElementText(a);j.collapse(true)}j.move("character",f.offset);return j}
var h=g(c);d&&d!=c&&h.setEndPoint("EndToEnd",g(d));h.select()};select.getBookmark=function(a){var c=select.cursorPos(a,true);a=select.cursorPos(a,false);if(c&&a)return{from:c,to:a}};select.setBookmark=function(a,c){c&&select.setCursorPos(a,c.from,c.to)}}else{var t=function(a,c){for(;a.nodeType!=3&&!isBR(a);){var d=a.childNodes[c]||a.nextSibling;for(c=0;!d&&a.parentNode;){a=a.parentNode;d=a.nextSibling}a=d;if(!d)break}return{node:a,offset:c}};select.markSelection=function(a){var c=a.getSelection();
if(!c||c.rangeCount==0)return k=null;c=c.getRangeAt(0);k={start:t(c.startContainer,c.startOffset),end:t(c.endContainer,c.endOffset),window:a,changed:false}};select.selectMarked=function(){function a(){if(d.start.node==d.end.node&&d.start.offset==d.end.offset){var f=d.window.getSelection();if(!f||f.rangeCount==0)return true;f=f.getRangeAt(0);f=t(f.startContainer,f.startOffset);return d.start.node!=f.node||d.start.offset!=f.offset}}function c(f,j){if(f.node)f.offset==0?h["set"+j+"Before"](f.node):h["set"+
j](f.node,f.offset);else h.setStartAfter(g.document.body.lastChild||g.document.body)}var d=k;if(d&&(d.changed||webkit&&a())){var g=d.window,h=g.document.createRange();c(d.end,"End");c(d.start,"Start");v(h,g)}};var v=function(a,c){var d=c.getSelection();if(d){d.removeAllRanges();d.addRange(a)}},i=function(a){a=a.getSelection();return!a||a.rangeCount==0?false:a.getRangeAt(0)};select.selectionTopNode=function(a,c){var d=i(a.ownerDocument.defaultView);if(!d)return false;var g=c?d.startContainer:d.endContainer,
h=c?d.startOffset:d.endOffset;window.opera&&!c&&d.endContainer==a&&d.endOffset==d.startOffset+1&&a.childNodes[d.startOffset]&&isBR(a.childNodes[d.startOffset])&&h--;return g.nodeType==3?h>0?e(g,a):o(g,a):g.nodeName.toUpperCase()=="HTML"?h==1?null:a.lastChild:g==a?h==0?null:g.childNodes[h-1]:h==g.childNodes.length?e(g,a):h==0?o(g,a):e(g.childNodes[h-1],a)};select.focusAfterNode=function(a,c){var d=c.ownerDocument.defaultView,g=d.document.createRange();g.setStartBefore(c.firstChild||c);if(a&&!a.firstChild)g.setEndAfter(a);
else a?g.setEnd(a,a.childNodes.length):g.setEndBefore(c.firstChild||c);g.collapse(false);v(g,d)};select.somethingSelected=function(a){return(a=i(a))&&!a.collapsed};select.offsetInNode=function(a,c){var d=i(a);if(!d)return 0;d=d.cloneRange();d.setStartBefore(c);return d.toString().length};var b=function(a,c){var d=i(a);if(d){d.deleteContents();d.insertNode(c);if(a.opera&&isBR(c)&&isSpan(c.parentNode)){d=c.nextSibling;var g=c.parentNode,h=g.parentNode;h.insertBefore(c,g.nextSibling);for(g="";d&&d.nodeType==
3;d=d.nextSibling){g+=d.nodeValue;removeElement(d)}h.insertBefore(makePartSpan(g,a.document),c.nextSibling)}d=a.document.createRange();d.selectNode(c);d.collapse(false);v(d,a)}};select.insertNewlineAtCursor=function(a){webkit?document.execCommand("insertLineBreak"):b(a,a.document.createElement("BR"))};select.insertTabAtCursor=function(a){b(a,a.document.createTextNode("\u00a0\u00a0\u00a0\u00a0"))};select.cursorPos=function(a,c){var d=i(window);if(d){for(var g=select.selectionTopNode(a,c);g&&!isBR(g);)g=
g.previousSibling;d=d.cloneRange();d.collapse(c);g?d.setStartAfter(g):d.setStartBefore(a);return{node:g,offset:d.toString().length}}};select.setCursorPos=function(a,c,d){function g(j,l,r){function u(A){A.nodeType==3?q.push(A):forEach(A.childNodes,u)}if(l==0&&j&&!j.nextSibling){f["set"+r+"After"](j);return true}if(j=j?j.nextSibling:a.firstChild){if(l==0){f["set"+r+"Before"](j);return true}for(var q=[];;){for(;j&&!q.length;){u(j);j=j.nextSibling}var s=q.shift();if(!s)return false;var z=s.nodeValue.length;
if(z>=l){f["set"+r](s,l);return true}l-=z}}}var h=a.ownerDocument.defaultView,f=h.document.createRange();d=d||c;g(d.node,d.offset,"End")&&g(c.node,c.offset,"Start")&&v(f,h)}}})();function UndoHistory(e,o,k,p){this.container=e;this.maxDepth=o;this.commitDelay=k;this.editor=p;this.parent=p.parent;this.last=this.first=e={text:"",from:null,to:null};this.firstTouched=false;this.history=[];this.redoHistory=[];this.touched=[]}
UndoHistory.prototype={scheduleCommit:function(){var e=this;this.parent.clearTimeout(this.commitTimeout);this.commitTimeout=this.parent.setTimeout(function(){e.tryCommit()},this.commitDelay)},touch:function(e){this.setTouched(e);this.scheduleCommit()},undo:function(){this.commit();if(this.history.length){var e=this.history.pop();this.redoHistory.push(this.updateTo(e,"applyChain"));this.notifyEnvironment();return this.chainNode(e)}},redo:function(){this.commit();if(this.redoHistory.length){var e=this.redoHistory.pop();
this.addUndoLevel(this.updateTo(e,"applyChain"));this.notifyEnvironment();return this.chainNode(e)}},clear:function(){this.history=[];this.redoHistory=[]},historySize:function(){return{undo:this.history.length,redo:this.redoHistory.length}},push:function(e,o,k){for(var p=[],n=0;n<k.length;n++){var t=n==k.length-1?o:this.container.ownerDocument.createElement("BR");p.push({from:e,to:t,text:cleanText(k[n])});e=t}this.pushChains([p],e==null&&o==null);this.notifyEnvironment()},pushChains:function(e,o){this.commit(o);
this.addUndoLevel(this.updateTo(e,"applyChain"));this.redoHistory=[]},chainNode:function(e){for(var o=0;o<e.length;o++){var k=e[o][0];if(k=k&&(k.from||k.to))return k}},reset:function(){this.history=[];this.redoHistory=[]},textAfter:function(e){return this.after(e).text},nodeAfter:function(e){return this.after(e).to},nodeBefore:function(e){return this.before(e).from},tryCommit:function(){if(window.UndoHistory)this.editor.highlightDirty()?this.commit(true):this.scheduleCommit()},commit:function(e){this.parent.clearTimeout(this.commitTimeout);
e||this.editor.highlightDirty(true);e=this.touchedChains();if(e.length){this.addUndoLevel(this.updateTo(e,"linkChain"));this.redoHistory=[];this.notifyEnvironment()}},updateTo:function(e,o){for(var k=[],p=[],n=0;n<e.length;n++){k.push(this.shadowChain(e[n]));p.push(this[o](e[n]))}o=="applyChain"&&this.notifyDirty(p);return k},notifyDirty:function(e){forEach(e,method(this.editor,"addDirtyNode"));this.editor.scheduleHighlight()},notifyEnvironment:function(){this.onChange&&this.onChange();window.frameElement&&
window.frameElement.CodeMirror.updateNumbers&&window.frameElement.CodeMirror.updateNumbers()},linkChain:function(e){for(var o=0;o<e.length;o++){var k=e[o];if(k.from)k.from.historyAfter=k;else this.first=k;if(k.to)k.to.historyBefore=k;else this.last=k}},after:function(e){return e?e.historyAfter:this.first},before:function(e){return e?e.historyBefore:this.last},setTouched:function(e){if(e){if(!e.historyTouched){this.touched.push(e);e.historyTouched=true}}else this.firstTouched=true},addUndoLevel:function(e){this.history.push(e);
this.history.length>this.maxDepth&&this.history.shift()},touchedChains:function(){function e(i,b){if(i)i.historyTemp=b;else n=b}function o(i){for(var b=[],a=i?i.nextSibling:p.container.firstChild;a&&!isBR(a);a=a.nextSibling)a.currentText&&b.push(a.currentText);return{from:i,to:a,text:cleanText(b.join(""))}}function k(i,b){for(var a=b+"Sibling",c=i[a];c&&!isBR(c);)c=c[a];return c}var p=this,n=null,t=[];p.firstTouched&&p.touched.push(null);forEach(p.touched,function(i){if(!(i&&i.parentNode!=p.container)){if(i)i.historyTouched=
false;else p.firstTouched=false;var b=o(i),a=p.after(i);if(!a||a.text!=b.text||a.to!=b.to){t.push(b);e(i,b)}}});var v=[];p.touched=[];forEach(t,function(i){if(i.from?i.from.historyTemp:n){for(var b=[],a=i.from,c=true;;){var d=a?a.historyTemp:n;if(!d)if(c)break;else d=o(a);b.unshift(d);e(a,null);if(!a)break;c=p.after(a);a=k(a,"previous")}a=i.to;for(c=p.before(i.from);;){if(!a)break;d=a?a.historyTemp:n;if(!d)if(c)break;else d=o(a);b.push(d);e(a,null);c=p.before(a);a=k(a,"next")}v.push(b)}});return v},
shadowChain:function(e){var o=[],k=this.after(e[0].from);for(e=e[e.length-1].to;;){o.push(k);k=k.to;if(!k||k==e)break;else k=k.historyAfter||this.before(e)}return o},applyChain:function(e){var o=select.cursorPos(this.container,false),k=this,p=e[0].from,n=e[e.length-1].to;(function(c,d){for(var g=c?c.nextSibling:k.container.firstChild;g!=d;){var h=g.nextSibling;removeElement(g);g=h}})(p,n);for(var t=0;t<e.length;t++){var v=e[t];t>0&&k.container.insertBefore(v.from,n);var i=makePartSpan(fixSpaces(v.text),
this.container.ownerDocument);k.container.insertBefore(i,n);if(o&&o.node==v.from){i=0;var b=this.after(v.from);if(b&&t==e.length-1){for(var a=0;a<o.offset&&v.text.charAt(a)==b.text.charAt(a);a++);if(o.offset>a)i=v.text.length-b.text.length}select.setCursorPos(this.container,{node:v.from,offset:Math.max(0,o.offset+i)})}else o&&t==e.length-1&&o.node&&o.node.parentNode!=this.container&&select.setCursorPos(this.container,{node:v.from,offset:v.text.length})}this.linkChain(e);return p}};var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computers, Inc/.test(navigator.vendor),gecko=/gecko\/(\d{8})/i.test(navigator.userAgent),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent);function makeWhiteSpace(e){for(var o=[],k=true;e>0;e--){o.push(k||e==1?nbsp:" ");k^=true}return o.join("")}
function fixSpaces(e){if(e.charAt(0)==" ")e=nbsp+e.slice(1);return e.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(o){return makeWhiteSpace(o.length)})}function cleanText(e){return e.replace(/\u00a0/g," ")}function makePartSpan(e,o){var k=e;if(e.nodeType==3)k=e.nodeValue;else e=o.createTextNode(k);var p=o.createElement("SPAN");p.isPart=true;p.appendChild(e);p.currentText=k;return p}
var Editor=function(){function e(b){var a=makeWhiteSpace(indentUnit);return map(b.replace(/\t/g,a).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function o(b,a){function c(f,j){if(f.nodeType==3){if((f.nodeValue=fixSpaces(f.nodeValue.replace(/\r/g,"").replace(/\n/g," "))).length)h=false;g.push(f)}else if(isBR(f)&&f.childNodes.length==0){h=true;g.push(f)}else{for(var l=f.firstChild;l;l=l.nextSibling)c(l);if(!h&&i.hasOwnProperty(f.nodeName.toUpperCase())){h=true;if(!a||!j)g.push(d.createElement("BR"))}}}
var d=b.ownerDocument,g=[],h=true;c(b,true);return g}function k(b){function a(f){var j=f.parentNode,l=f.nextSibling;return function(r){j.insertBefore(r,l)}}var c=b.ownerDocument,d=[],g=null,h=true;return{next:function(){if(!b)throw StopIteration;var f=b;b=f.nextSibling;var j;if(f.isPart&&f.childNodes.length==1&&f.firstChild.nodeType==3){f.currentText=f.firstChild.nodeValue;j=!/[\n\t\r]/.test(f.currentText)}else j=false;if(j){d.push(f);h=false;return f.currentText}else if(isBR(f)){h&&window.opera&&
f.parentNode.insertBefore(makePartSpan("",c),f);d.push(f);h=true;return"\n"}else{j=!f.nextSibling;g=a(f);removeElement(f);f=o(f,j);for(j=0;j<f.length;j++){var l=f,r=j,u=f[j],q="\n";if(u.nodeType==3){select.snapshotChanged();u=makePartSpan(u,c);q=u.currentText;h=false}else{h&&window.opera&&g(makePartSpan("",c));h=true}u.dirty=true;d.push(u);g(u);l[r]=q}return f.join("")}},nodes:d}}function p(b){for(;b&&!isBR(b);)b=b.previousSibling;return b}function n(b,a){if(b){if(isBR(b))b=b.nextSibling}else b=a.firstChild;
for(;b&&!isBR(b);)b=b.nextSibling;return b}function t(b,a,c,d){this.editor=b;if(d==undefined)d=a==a.toLowerCase();if(this.caseFold=d)a=a.toLowerCase();this.history=b.history;this.history.commit();this.atOccurrence=false;this.fallbackSize=15;var g;if(c&&(g=select.cursorPos(this.editor.container))){this.line=g.node;this.offset=g.offset}else{this.line=null;this.offset=0}this.valid=!!a;var h=a.split("\n"),f=this;this.matches=h.length==1?function(){var j=cleanText(f.history.textAfter(f.line).slice(f.offset));
j=(f.caseFold?j.toLowerCase():j).indexOf(a);if(j>-1)return{from:{node:f.line,offset:f.offset+j},to:{node:f.line,offset:f.offset+j+a.length}}}:function(){var j=cleanText(f.history.textAfter(f.line).slice(f.offset)),l=(f.caseFold?j.toLowerCase():j).lastIndexOf(h[0]);if(l==-1||l!=j.length-h[0].length)return false;j=f.offset+l;l=f.history.nodeAfter(f.line);for(var r=1;r<h.length-1;r++){var u=cleanText(f.history.textAfter(l));if((f.caseFold?u.toLowerCase():u)!=h[r])return false;l=f.history.nodeAfter(l)}r=
cleanText(f.history.textAfter(l));if((f.caseFold?r.toLowerCase():r).indexOf(h[h.length-1])!=0)return false;return{from:{node:f.line,offset:j},to:{node:l,offset:h[h.length-1].length}}}}function v(b){this.options=b;window.indentUnit=b.indentUnit;this.parent=parent;this.doc=document;var a=this.container=this.doc.body;this.win=window;this.history=new UndoHistory(a,b.undoDepth,b.undoDelay,this);var c=this;if(!v.Parser)throw"No parser loaded.";b.parserConfig&&v.Parser.configure&&v.Parser.configure(b.parserConfig);
b.readOnly||select.setCursorPos(a,{node:null,offset:0});this.dirty=[];this.importCode(b.content||"");this.history.onChange=b.onChange;if(b.readOnly){if(!b.textWrapping)a.style.whiteSpace="nowrap"}else{if(b.continuousScanning!==false){this.scanner=this.documentScanner(b.passTime);this.delayScanning()}var d=function(){if(document.body.contentEditable!=undefined&&internetExplorer)document.body.contentEditable="true";else document.designMode="on";document.documentElement.style.borderWidth="0";if(!b.textWrapping)a.style.whiteSpace=
"nowrap"};try{d()}catch(g){var h=addEventHandler(document,"focus",function(){h();d()},true)}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));var f=function(){c.cursorActivity(false)};addEventHandler(document.body,"mouseup",f);addEventHandler(document.body,"cut",f);gecko&&addEventHandler(this.win,"pagehide",function(){c.unloaded=true});addEventHandler(document.body,"paste",
function(j){f();var l=null;try{var r=j.clipboardData||window.clipboardData;if(r)l=r.getData("Text")}catch(u){}if(l!==null){j.stop();c.replaceSelection(l);select.scrollToCursor(c.container)}});this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}var i={P:true,DIV:true,LI:true};t.prototype={findNext:function(){function b(d){if(a.history.textAfter(d.node).length>d.offset){a.line=d.node;a.offset=d.offset+1}else{a.line=a.history.nodeAfter(d.node);
a.offset=0}}if(!this.valid)return false;this.atOccurrence=false;var a=this;if(this.line&&!this.line.parentNode){this.line=null;this.offset=0}for(;;){var c=this.matches();if(c){this.atOccurrence=c;b(c.from);return true}this.line=this.history.nodeAfter(this.line);this.offset=0;if(!this.line)return this.valid=false}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.atOccurrence.from,this.atOccurrence.to);select.scrollToCursor(this.editor.container)}},replace:function(b){if(this.atOccurrence){b=
this.editor.replaceRange(this.atOccurrence.from,this.atOccurrence.to,b);this.line=b.node;this.offset=b.offset;this.atOccurrence=false}}};v.prototype={importCode:function(b){this.history.push(null,null,e(b));this.history.reset()},getCode:function(){if(!this.container.firstChild)return"";var b=[];select.markSelection(this.win);forEach(k(this.container.firstChild),method(b,"push"));select.selectMarked();return cleanText(b.join(""))},checkLine:function(b){if(b===false||!(b==null||b.parentNode==this.container))throw parent.CodeMirror.InvalidLineHandle;
},cursorPosition:function(b){if(b==null)b=true;return(b=select.cursorPos(this.container,b))?{line:b.node,character:b.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){return this.container.lastChild?p(this.container.lastChild):null},nextLine:function(b){this.checkLine(b);return n(b,this.container)||false},prevLine:function(b){this.checkLine(b);if(b==null)return false;return p(b.previousSibling)},visibleLineCount:function(){for(var b=this.container.firstChild;b&&
isBR(b);)b=b.nextSibling;if(!b)return false;return Math.floor((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)/b.offsetHeight)},selectLines:function(b,a,c,d){this.checkLine(b);b={node:b,offset:a};a=null;if(d!==undefined){this.checkLine(c);a={node:c,offset:d}}select.setCursorPos(this.container,b,a);select.scrollToCursor(this.container)},lineContent:function(b){var a=[];for(b=b?b.nextSibling:this.container.firstChild;b&&!isBR(b);b=b.nextSibling)a.push(nodeText(b));
return cleanText(a.join(""))},setLineContent:function(b,a){this.history.commit();this.replaceRange({node:b,offset:0},{node:b,offset:this.history.textAfter(b).length},a);this.addDirtyNode(b);this.scheduleHighlight()},removeLine:function(b){for(var a=b?b.nextSibling:this.container.firstChild;a;){var c=a.nextSibling;removeElement(a);if(isBR(a))break;a=c}this.addDirtyNode(b);this.scheduleHighlight()},insertIntoLine:function(b,a,c){var d=null;if(a=="end")d=n(b,this.container);else for(var g=b?b.nextSibling:
this.container.firstChild;g;g=g.nextSibling){if(a==0){d=g;break}var h=nodeText(g);if(h.length>a){d=g.nextSibling;c=h.slice(0,a)+c+h.slice(a);removeElement(g);break}a-=h.length}a=e(c);c=this.container.ownerDocument;for(g=0;g<a.length;g++){g>0&&this.container.insertBefore(c.createElement("BR"),d);this.container.insertBefore(makePartSpan(a[g],c),d)}this.addDirtyNode(b);this.scheduleHighlight()},selectedText:function(){var b=this.history;b.commit();var a=select.cursorPos(this.container,true),c=select.cursorPos(this.container,
false);if(!a||!c)return"";if(a.node==c.node)return b.textAfter(a.node).slice(a.offset,c.offset);var d=[b.textAfter(a.node).slice(a.offset)];for(a=b.nodeAfter(a.node);a!=c.node;a=b.nodeAfter(a))d.push(b.textAfter(a));d.push(b.textAfter(c.node).slice(0,c.offset));return cleanText(d.join("\n"))},replaceSelection:function(b){this.history.commit();var a=select.cursorPos(this.container,true),c=select.cursorPos(this.container,false);if(a&&c){c=this.replaceRange(a,c,b);select.setCursorPos(this.container,
c)}},cursorCoords:function(b){function a(j,l){var r=-(f.win.document.body.scrollTop||f.win.document.documentElement.scrollTop||0),u=-(f.win.document.body.scrollLeft||f.win.document.documentElement.scrollLeft||0)+l;forEach([j,f.win.frameElement],function(q){for(;q;){u+=q.offsetLeft;r+=q.offsetTop;q=q.offsetParent}});return{x:u,y:r,yBot:r+j.offsetHeight}}function c(j,l){var r=h.createElement("SPAN");r.appendChild(h.createTextNode(j));try{return l(r)}finally{r.parentNode&&r.parentNode.removeChild(r)}}
var d=select.cursorPos(this.container,b);if(!d)return null;b=d.offset;for(var g=d.node,h=this.win.document,f=this;b;){g=g?g.nextSibling:this.container.firstChild;d=nodeText(g);if(b<d.length)return c(d.substr(0,b),function(j){j.style.position="absolute";j.style.visibility="hidden";j.className=g.className;f.container.appendChild(j);return a(g,j.offsetWidth)});b-=d.length}return g&&isSpan(g)?a(g,g.offsetWidth):g&&g.nextSibling&&isSpan(g.nextSibling)?a(g.nextSibling,0):c("\u200b",function(j){g?g.parentNode.insertBefore(j,
g.nextSibling):f.container.insertBefore(j,f.container.firstChild);return a(j,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera)){this.capturingPaste=true;var b=window.frameElement.CodeMirror.textareaHack;parent.focus();b.value="";b.focus();var a=this;this.parent.setTimeout(function(){a.capturingPaste=false;a.win.focus();a.selectionSnapshot&&a.win.select.setBookmark(a.container,a.selectionSnapshot);var c=b.value;if(c){a.replaceSelection(c);select.scrollToCursor(a.container)}},
10)}},replaceRange:function(b,a,c){c=e(c);c[0]=this.history.textAfter(b.node).slice(0,b.offset)+c[0];var d=c[c.length-1];c[c.length-1]=d+this.history.textAfter(a.node).slice(a.offset);a=this.history.nodeAfter(a.node);this.history.push(b.node,a,c);return{node:this.history.nodeBefore(a),offset:d.length}},getSearchCursor:function(b,a,c){return new t(this,b,a,c)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(b){if(select.somethingSelected(this.win)){var a=
select.selectionTopNode(this.container,true),c=select.selectionTopNode(this.container,false);a===false||c===false||this.indentRegion(a,c,b)}else this.indentAtCursor(b)},grabKeys:function(b,a){this.frozen=b;this.keyFilter=a},ungrabKeys:function(){this.frozen="leave"},setParser:function(b,a){v.Parser=window[b];(a=a||this.options.parserConfig)&&v.Parser.configure&&v.Parser.configure(a);if(this.container.firstChild){forEach(this.container.childNodes,function(c){if(c.nodeType!=3)c.dirty=true});this.addDirtyNode(this.firstChild);
this.scheduleHighlight()}},keyDown:function(b){if(this.frozen=="leave")this.keyFilter=this.frozen=null;if(this.frozen&&(!this.keyFilter||this.keyFilter(b.keyCode,b))){b.stop();this.frozen(b)}else{var a=this.lastKeyDownCode=b.keyCode;this.delayScanning();this.options.autoMatchParens&&this.scheduleParenHighlight();if(a==13){if(b.ctrlKey&&!b.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor(this.win);this.indentAtCursor();select.scrollToCursor(this.container)}b.stop()}else if(a==9&&this.options.tabMode!=
"default"&&!b.ctrlKey){this.handleTab(!b.shiftKey);b.stop()}else if(a==32&&b.shiftKey&&this.options.tabMode=="default"){this.handleTab(true);b.stop()}else if(a==36&&!b.shiftKey&&!b.ctrlKey)this.home()&&b.stop();else if(a==35&&!b.shiftKey&&!b.ctrlKey)this.end()&&b.stop();else if(a==33&&!b.shiftKey&&!b.ctrlKey&&!gecko)this.pageUp()&&b.stop();else if(a==34&&!b.shiftKey&&!b.ctrlKey&&!gecko)this.pageDown()&&b.stop();else if((a==219||a==221)&&b.ctrlKey&&!b.altKey){this.highlightParens(b.shiftKey,true);
b.stop()}else if(b.metaKey&&!b.shiftKey&&(a==37||a==39)){var c=select.selectionTopNode(this.container);if(c!==false&&this.container.firstChild){if(a==37)select.focusAfterNode(p(c),this.container);else{a=n(c,this.container);select.focusAfterNode(a?a.previousSibling:this.container.lastChild,this.container)}b.stop()}}else if((b.ctrlKey||b.metaKey)&&!b.altKey)if(b.shiftKey&&a==90||a==89){select.scrollToNode(this.history.redo());b.stop()}else if(a==90||safari&&a==8){select.scrollToNode(this.history.undo());
b.stop()}else if(a==83&&this.options.saveFunction){this.options.saveFunction();b.stop()}else internetExplorer&&a==86&&this.reroutePasteEvent();this.keyUpOrPressAfterLastKeyDown=false}},keyPress:function(b){this.keyUpOrPressAfterLastKeyDown=true;var a=v.Parser.electricChars,c=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(b.keyCode||b.code,b))||b.code==13||b.code==9&&this.options.tabMode!="default"||b.code==32&&b.shiftKey&&this.options.tabMode=="default")b.stop();else if(a&&a.indexOf(b.character)!=
-1)this.parent.setTimeout(function(){c.indentAtCursor(null)},0);else if((b.character=="v"||b.character=="V")&&(b.ctrlKey||b.metaKey)&&!b.altKey)this.reroutePasteEvent();else if(brokenOpera)if(b.code==8){var d=select.selectionTopNode(this.container);c=this;var g=d?d.nextSibling:this.container.firstChild;d!==false&&g&&isBR(g)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)==g&&select.focusAfterNode(g.previousSibling,c.container)},20)}else if(b.code==46){d=select.selectionTopNode(this.container);
c=this;d&&isBR(d)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)!=d&&select.focusAfterNode(d,c.container)},20)}},keyUp:function(b){this.keyUpOrPressAfterLastKeyDown=true;this.cursorActivity(b.keyCode>=16&&b.keyCode<=18||b.keyCode>=33&&b.keyCode<=40)},indentLineAfter:function(b,a){var c=b?b.nextSibling:this.container.firstChild;if(c&&!hasClass(c,"whitespace"))c=null;var d=c?c.nextSibling:b?b.nextSibling:this.container.firstChild,g=b&&d&&d.currentText?d.currentText:"",h=0,f=
c?c.currentText.length:0;if(a!=null&&this.options.tabMode=="shift")h=a?f+indentUnit:Math.max(0,f-indentUnit);else if(b)h=b.indentation(g,f,a);else if(v.Parser.firstIndentation)h=v.Parser.firstIndentation(g,f,a);g=h-f;if(g<0)if(h==0){d&&select.snapshotMove(c.firstChild,d.firstChild,0);removeElement(c)}else{select.snapshotMove(c.firstChild,c.firstChild,g,true);c.currentText=makeWhiteSpace(h);c.firstChild.nodeValue=c.currentText}else if(g>0)if(c){c.currentText=makeWhiteSpace(h);c.firstChild.nodeValue=
c.currentText;select.snapshotMove(c.firstChild,c.firstChild,g,true)}else{c=makePartSpan(makeWhiteSpace(h),this.doc);c.className="whitespace";b?insertAfter(c,b):this.container.insertBefore(c,this.container.firstChild);select.snapshotMove(d&&(d.firstChild||d),c.firstChild,h,false,true)}g!=0&&this.addDirtyNode(b)},highlightAtCursor:function(){var b=select.selectionTopNode(this.container,true),a=select.selectionTopNode(this.container,false);if(b===false||a===false)return false;select.markSelection(this.win);
if(this.highlight(b,n(a,this.container),true,20)===false)return false;select.selectMarked();return true},handleTab:function(b){this.options.tabMode=="spaces"?select.insertTabAtCursor(this.win):this.reindentSelection(b)},home:function(){var b=select.selectionTopNode(this.container,true),a=b;if(b===false||!(!b||b.isPart||isBR(b))||!this.container.firstChild)return false;for(;b&&!isBR(b);)b=b.previousSibling;var c=b?b.nextSibling:this.container.firstChild;c&&c!=a&&c.isPart&&hasClass(c,"whitespace")?
select.focusAfterNode(c,this.container):select.focusAfterNode(b,this.container);select.scrollToCursor(this.container);return true},end:function(){var b=select.selectionTopNode(this.container,true);if(b===false)return false;b=n(b,this.container);if(!b)return false;select.focusAfterNode(b.previousSibling,this.container);select.scrollToCursor(this.container);return true},pageUp:function(){var b=this.cursorPosition().line,a=this.visibleLineCount();if(b===false||a===false)return false;a-=2;for(var c=0;c<
a;c++){b=this.prevLine(b);if(b===false)break}if(c==0)return false;select.setCursorPos(this.container,{node:b,offset:0});select.scrollToCursor(this.container);return true},pageDown:function(){var b=this.cursorPosition().line,a=this.visibleLineCount();if(b===false||a===false)return false;a-=2;for(var c=0;c<a;c++){var d=this.nextLine(b);if(d===false)break;b=d}if(c==0)return false;select.setCursorPos(this.container,{node:b,offset:0});select.scrollToCursor(this.container);return true},scheduleParenHighlight:function(){this.parenEvent&&
this.parent.clearTimeout(this.parenEvent);var b=this;this.parenEvent=this.parent.setTimeout(function(){b.highlightParens()},300)},highlightParens:function(b,a){function c(s,z){if(s)if(f.options.markParen)f.options.markParen(s,z);else{s.style.fontWeight="bold";s.style.color=z?"#8F8":"#F88"}}function d(s){if(s)if(f.options.unmarkParen)f.options.unmarkParen(s);else{s.style.fontWeight="";s.style.color=""}}function g(s){if(s.currentText)return(s=s.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/))&&
s[1]}function h(){for(var s=[],z,A=true,w=l;w;w=u?w.nextSibling:w.previousSibling)if(w.className==r&&isSpan(w)&&(z=g(w))){if(/[\(\[\{]/.test(z)==u)s.push(z);else if(s.length){if(s.pop()!=matching[z])A=false}else A=false;if(!s.length)break}else if(w.dirty||!isSpan(w)&&!isBR(w))return{node:w,status:"dirty"};return{node:w,status:w&&A}}var f=this;if(!a&&f.highlighted){d(f.highlighted[0]);d(f.highlighted[1])}if(window.select){this.parenEvent&&this.parent.clearTimeout(this.parenEvent);this.parenEvent=null;
var j,l=select.selectionTopNode(this.container,true);if(l&&this.highlightAtCursor())if((l=select.selectionTopNode(this.container,true))&&((j=g(l))||(l=l.nextSibling)&&(j=g(l))))for(var r=l.className,u=/[\(\[\{]/.test(j);;){var q=h();if(q.status=="dirty"){this.highlight(q.node,n(q.node));q.node.dirty=false}else{c(l,q.status);c(q.node,q.status);if(a)f.parent.setTimeout(function(){d(l);d(q.node)},500);else f.highlighted=[l,q.node];b&&q.node&&select.focusAfterNode(q.node.previousSibling,this.container);
break}}}},indentAtCursor:function(b){if(this.container.firstChild)if(this.highlightAtCursor()){var a=select.selectionTopNode(this.container,false);if(a!==false){select.markSelection(this.win);this.indentLineAfter(p(a),b);select.selectMarked()}}},indentRegion:function(b,a,c){var d=b=p(b),g=b&&p(b.previousSibling);isBR(a)||(a=n(a,this.container));this.addDirtyNode(b);do{var h=n(d,this.container);d&&this.highlight(g,h,true);this.indentLineAfter(d,c);g=d;d=h}while(d!=a);select.setCursorPos(this.container,
{node:b,offset:0},{node:a,offset:0})},cursorActivity:function(b){if(this.unloaded){this.win.document.designMode="off";this.win.document.designMode="on";this.unloaded=false}if(internetExplorer){this.container.createTextRange().execCommand("unlink");this.selectionSnapshot=select.getBookmark(this.container)}var a=this.options.cursorActivity;if(!b||a){var c=select.selectionTopNode(this.container,false);if(!(c===false||!this.container.firstChild)){c=c||this.container.firstChild;a&&a(c);if(!b){this.scheduleHighlight();
this.addDirtyNode(c)}}}},reparseBuffer:function(){forEach(this.container.childNodes,function(b){b.dirty=true});this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(b){if(b=b||this.container.firstChild){for(var a=0;a<this.dirty.length;a++)if(this.dirty[a]==b)return;if(b.nodeType!=3)b.dirty=true;this.dirty.push(b)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var b=this;this.parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=
this.parent.setTimeout(function(){b.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){for(;this.dirty.length>0;){var b=this.dirty.pop();try{for(;b&&b.parentNode!=this.container;)b=b.parentNode;if(b&&(b.dirty||b.nodeType==3))return b}catch(a){}}return null},highlightDirty:function(b){if(!window.select)return false;this.options.readOnly||select.markSelection(this.win);for(var a,c=b?null:(new Date).getTime()+this.options.passTime;((new Date).getTime()<c||b)&&(a=this.getDirtyNode());){var d=
this.highlight(a,c);d&&d.node&&d.dirty&&this.addDirtyNode(d.node.nextSibling)}this.options.readOnly||select.selectMarked();a&&this.scheduleHighlight();return this.dirty.length==0},documentScanner:function(b){var a=this,c=null;return function(){if(window.select){if(c&&c.parentNode!=a.container)c=null;select.markSelection(a.win);var d=a.highlight(c,(new Date).getTime()+b,true);select.selectMarked();d=d?d.node&&d.node.nextSibling:null;c=c==d?null:d;a.delayScanning()}}},delayScanning:function(){if(this.scanner){this.parent.clearTimeout(this.documentScan);
this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning)}},isIMEOn:function(){return this.lastKeyDownCode==229||this.keyUpOrPressAfterLastKeyDown===false},highlight:function(b,a,c,d){function g(w){if(w){var x=w.oldNextSibling;if(s||x===undefined||w.nextSibling!=x)f.history.touch(w);w.oldNextSibling=w.nextSibling}else{x=f.container.oldFirstChild;if(s||x===undefined||f.container.firstChild!=x)f.history.touch(null);f.container.oldFirstChild=f.container.firstChild}}var h=
this.container,f=this,j=this.options.activeTokens,l=typeof a=="number"?a:null;if(!h.firstChild||this.isIMEOn())return false;for(;b&&(!b.parserFromHere||b.dirty);){if(d!=null&&isBR(b)&&--d<0)return false;b=b.previousSibling}if(b&&!b.nextSibling)return false;var r=k(b?b.nextSibling:h.firstChild);d=stringStream(r);var u=b?b.parserFromHere(d):v.Parser.make(d),q={current:null,get:function(){if(!this.current)this.current=r.nodes.shift();return this.current},next:function(){this.current=null},remove:function(){h.removeChild(this.get());
this.current=null},getNonEmpty:function(){for(var w=this.get();w&&isSpan(w)&&w.currentText=="";)if(window.opera&&(w.previousSibling==null||isBR(w.previousSibling))&&(w.nextSibling==null||isBR(w.nextSibling))){this.next();w=this.get()}else{var x=w;this.remove();w=this.get();select.snapshotMove(x.firstChild,w&&(w.firstChild||w),0)}return w}},s=false,z=true,A=0;forEach(u,function(w){var x=q.getNonEmpty();if(w.value=="\n"){if(!isBR(x))throw"Parser out of sync. Expected BR.";if(x.dirty||!x.indentation)s=
true;g(b);b=x;x.parserFromHere=u.copy();x.indentation=w.indentation;x.dirty=false;if(l==null&&x==a)throw StopIteration;if(l!=null&&(new Date).getTime()>=l||!s&&!z&&A>1&&!c)throw StopIteration;z=s;s=false;A=0;q.next()}else{if(!isSpan(x))throw"Parser out of sync. Expected SPAN.";if(x.dirty)s=true;A++;if(!x.reduced&&x.currentText==w.value&&x.className==w.style){x.dirty=false;q.next()}else{s=true;var D=makePartSpan(w.value,f.doc);D.className=w.style;h.insertBefore(D,x);j&&j(D,w,f);w=w.value.length;for(var G=
0;w>0;){x=q.get();var H=x.currentText.length;select.snapshotReplaceNode(x.firstChild,D.firstChild,w,G);if(H>w){x=x;x.currentText=x.currentText.substring(w);x.reduced=true;w=0}else{w-=H;G+=H;q.remove()}}}}});g(b);return{node:q.getNonEmpty(),dirty:s}}};return v}();addEventHandler(window,"load",function(){var e=window.frameElement.CodeMirror;e.editor=new Editor(e.options);this.parent.setTimeout(method(e,"init"),0)});function tokenizer(e,o){function k(n){return n!="\n"&&/^[\s\u00a0]*$/.test(n)}var p={state:o,take:function(n){if(typeof n=="string")n={style:n,type:n};n.content=(n.content||"")+e.get();/\n$/.test(n.content)||e.nextWhile(k);n.value=n.content+e.get();return n},next:function(){if(!e.more())throw StopIteration;var n;if(e.equals("\n")){e.next();return this.take("whitespace")}if(e.applies(k))n="whitespace";else for(;!n;)n=this.state(e,function(t){p.state=t});return this.take(n)}};return p};var tokenizeJavaScript=function(){function e(i,b){for(var a=false;!i.endOfLine();){var c=i.next();if(c==b&&!a)return false;a=!a&&c=="\\"}return a}function o(i,b){return function(a,c){var d=i,g=k(i,b,a,function(f){d=f}),h=g.type=="operator"||g.type=="keyword c"||g.type.match(/^[\[{}\(,;:]$/);if(h!=b||d!=i)c(o(d,h));return g}}function k(i,b,a,c){function d(){a.nextWhileMatches(v);var r=a.get(),u=p.hasOwnProperty(r)&&p.propertyIsEnumerable(r)&&p[r];return u?{type:u.type,style:u.style,content:r}:{type:"variable",
style:"js-variable",content:r}}function g(r){var u="/*";for(r=r=="*";;){if(a.endOfLine())break;var q=a.next();if(q=="/"&&r){u=null;break}r=q=="*"}c(u);return{type:"comment",style:"js-comment"}}function h(r,u){for(var q=u,s=u.charAt(0),z=r==s;;){if(a.endOfLine())break;var A=a.next();if(A==s&&a.peek()==s&&z){a.next();q=null;break}z=A==s}c(q);return{type:"multilineString",style:"js-string"}}function f(){a.nextWhileMatches(n);return{type:"operator",style:"js-operator"}}function j(r){var u=e(a,r);c(u?
r:null);return{type:"string",style:"js-string"}}if(i=='"'||i=="'")return j(i);var l=a.next();if(i=="/*")return g(l);if(i=='"""'||i=="'''")return h(l,i);if(l=='"'&&a.lookAhead('""',true)||l=="'"&&a.lookAhead("''",true))return h("-",l+l+l);else if(l=='"'||l=="'")return j(l);else if(l=="`"||l=="#"){a.nextWhileMatches(v);return{type:"string",style:"js-string"}}else if(l==":"&&v.test(a.peek())){a.nextWhileMatches(v);return{type:"variable",style:"ometa-binding"}}else if(/[\[\]{}\(\),;\:\.]/.test(l))return{type:l,
style:"js-punctuation"};else if(l=="0"&&(a.equals("x")||a.equals("X"))){a.next();a.nextWhileMatches(t);return{type:"number",style:"js-atom"}}else if(/[0-9]/.test(l)){a.nextWhileMatches(/[0-9]/);if(a.equals(".")){a.next();a.nextWhileMatches(/[0-9]/)}if(a.equals("e")||a.equals("E")){a.next();a.equals("-")&&a.next();a.nextWhileMatches(/[0-9]/)}return{type:"number",style:"js-atom"}}else if(l=="/")if(a.equals("*")){a.next();return g(l)}else if(a.equals("/")){e(a,null);return{type:"comment",style:"js-comment"}}else{if(b){e(a,
"/");a.nextWhileMatches(/[gi]/);i={type:"regexp",style:"js-string"}}else i=f();return i}else return n.test(l)?f():d()}var p=function(){function i(h,f){return{type:h,style:"js-"+f}}var b=i("keyword a","keyword"),a=i("keyword b","keyword"),c=i("keyword c","keyword"),d=i("operator","keyword"),g=i("atom","atom");return{"if":b,"while":b,"with":b,"else":a,"do":a,"try":a,"finally":a,"return":c,"break":c,"continue":c,"new":c,"delete":c,"throw":c,"in":d,"typeof":d,"instanceof":d,"var":i("var","keyword"),"function":i("function",
"keyword"),"catch":i("catch","keyword"),"for":i("for","keyword"),"switch":i("switch","keyword"),"case":i("case","keyword"),"default":i("default","keyword"),"true":g,"false":g,"null":g,undefined:g,NaN:g,Infinity:g,ometa:a}}(),n=/[+\-*&%=<>!?|~]/,t=/[0-9A-Fa-f]/,v=/[\w\$_]/;return function(i,b){return tokenizer(i,b||o(false,true))}}();var JSParser=Editor.Parser=function(){function e(n,t,v,i,b,a){this.indented=n;this.column=t;this.type=v;if(i!=null)this.align=i;this.prev=b;this.info=a}function o(n){return function(t){var v=t&&t.charAt(0),i=n.type,b=v==i;return i=="vardef"?n.indented+4:i=="form"&&v=="{"?n.indented:i=="stat"||i=="form"?n.indented+indentUnit:n.info=="switch"&&!b?n.indented+(/^(?:case|default)\b/.test(t)?indentUnit:2*indentUnit):n.align?n.column-(b?1:0):n.indented+(b?0:indentUnit)}}var k={atom:true,number:true,variable:true,
string:true,regexp:true},p=false;return{make:function(n,t){function v(m){for(var y=m.length-1;y>=0;y--)E.push(m[y])}function i(){v(arguments);L=true}function b(){v(arguments);L=false}function a(){C={prev:C,vars:{"this":true,arguments:true}}}function c(){C=C.prev}function d(m){if(C){I="js-variabledef";C.vars[m]=true}}function g(m){for(var y=C;y;){if(y.vars[m])return true;y=y.prev}return false}function h(m,y){var F=function(){B=new e(M,K,m,null,B,y)};F.lex=true;return F}function f(){B=B.prev}function j(m){return function(y){y==
m?i():i(arguments.callee)}}function l(){return b(u,l)}function r(){return b(q,r)}function u(m){if(m=="var")i(h("vardef"),G,j(";"),f);else if(m=="keyword a")i(h("form"),q,u,f);else if(m=="keyword b")i(h("form"),u,f);else if(m=="{")i(h("}"),D,f);else if(m=="function")i(O);else if(m=="for")i(h("form"),j("("),h(")"),T,j(")"),f,u,f);else if(m=="variable")i(h("stat"),z);else if(m=="switch")i(h("form"),q,h("}","switch"),j("{"),D,f,f);else if(m=="case")i(q,j(":"));else if(m=="default")i(j(":"));else m=="catch"?
i(h("form"),a,j("("),Q,j(")"),u,f,c):b(h("stat"),q,j(";"),f)}function q(m){if(k.hasOwnProperty(m))i(s);else if(m=="function")i(O);else if(m=="keyword c")i(q);else if(m=="(")i(h(")"),q,j(")"),f,s);else if(m=="operator")i(q);else if(m=="[")i(h("]"),x(q,"]"),f,s);else m=="{"?i(h("}"),x(w,"}"),f,s):i()}function s(m){if(m=="operator")i(q);else if(m=="(")i(h(")"),x(q,")"),f,s);else if(m==".")i(A,s);else m=="["&&i(h("]"),q,j("]"),f,s)}function z(m){m==":"?i(f,u):b(s,j(";"),f)}function A(m){if(m=="variable"){I=
"js-property";i()}}function w(m){if(m=="variable")I="js-property";k.hasOwnProperty(m)&&i(j(":"),q)}function x(m,y){function F(J){if(J==",")i(m,F);else J==y?i():i(j(y))}return function(J){J==y?i():b(m,F)}}function D(m){m=="}"?i():b(u,D)}function G(m,y){if(m=="variable"){d(y);i(H)}else i()}function H(m,y){if(y=="=")i(q,H);else m==","&&i(G)}function T(m){if(m=="var")i(G,N);else if(m==";")b(N);else m=="variable"?i(U):b(N)}function U(m,y){y=="in"?i(q):i(s,N)}function N(m,y){if(m==";")i(R);else y=="in"?
i(q):i(q,j(";"),R)}function R(m){m==")"?b():i(q)}function O(m,y){if(m=="variable"){d(y);i(O)}else m=="("&&i(a,x(Q,")"),u,c)}function Q(m,y){if(m=="variable"){d(y);i()}}var P=tokenizeJavaScript(n),E=[p?r:l],C=null,B=new e((t||0)-indentUnit,0,"block",false),K=0,M=0,L,I,S={next:function(){for(;E[E.length-1].lex;)E.pop()();var m=P.next();if(m.type=="whitespace"&&K==0)M=m.value.length;K+=m.value.length;if(m.content=="\n"){M=K=0;if(!("align"in B))B.align=false;m.indentation=o(B);if(B.info=="multilineString"){B.align=
false;m.indentation=function(){return 0}}}if(m.type=="whitespace"||m.type=="comment")return m;if(m.type=="multilineString")B.info="multilineString";if(!("align"in B))B.align=true;for(;;){L=I=false;E.pop()(m.type,m.content);if(L){if(I)m.style=I;else if(m.type=="variable"&&g(m.content))m.style="js-localvariable";return m}}},copy:function(){var m=C,y=B,F=E.concat([]),J=P.state;return function(V){C=m;B=y;E=F.concat([]);K=M=0;P=tokenizeJavaScript(V,J);return S}}};f.lex=true;return S},electricChars:"{}:",
configure:function(n){if(n.json!=null)p=n.json}}}();
